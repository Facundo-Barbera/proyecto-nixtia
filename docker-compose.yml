services:
  # Next.js Application (Development) - Uses Supabase for database
  app:
    build:
      context: .
      dockerfile: Dockerfile.dev
    container_name: nixtia-app
    ports:
      - "3000:3000"
    volumes:
      - .:/app
      - /app/node_modules
      - /app/.next
    environment:
      - NODE_ENV=development
      - DATABASE_URL=${DATABASE_URL}
      - NEXT_PUBLIC_SUPABASE_URL=${NEXT_PUBLIC_SUPABASE_URL}
      - NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY=${NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY}
      - SUPABASE_SECRET_KEY=${SUPABASE_SECRET_KEY}
      - STRIPE_SECRET_KEY=${STRIPE_SECRET_KEY}
      - NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=${NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY}
    command: npm run dev
    stdin_open: true
    tty: true

  # Prisma Studio (Database GUI) - Connects to Supabase
  prisma-studio:
    build:
      context: .
      dockerfile: Dockerfile.dev
    container_name: nixtia-prisma-studio
    ports:
      - "5555:5555"
    volumes:
      - .:/app
      - /app/node_modules
    environment:
      - DATABASE_URL=${DATABASE_URL}
    command: npx prisma studio --port 5555 --hostname 0.0.0.0
    profiles:
      - tools
