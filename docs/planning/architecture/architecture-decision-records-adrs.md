# Architecture Decision Records (ADRs)

## ADR-001: Supabase-Only Data Layer

**Status:** Accepted
**Date:** 2025-11-25
**Context:** Prisma and Supabase have fundamental conflicts (RLS bypass, schema drift, connection pooling). Supabase is mandated by investment decision.
**Decision:** Remove Prisma entirely, use Supabase client exclusively for all database operations.
**Consequences:**
- ‚úÖ Native RLS security, no schema drift, simpler architecture, better performance
- ‚ö†Ô∏è Manual TypeScript types (mitigated via `supabase gen types typescript`)

## ADR-002: Supabase New API Key Format

**Status:** Accepted
**Date:** 2025-11-25
**Context:** Supabase introduced new API key format in June 2025 to improve security and enable independent key rotation. Legacy anon/service_role keys are being phased out (projects created after Nov 1, 2025 only get new format).
**Decision:** Use new Supabase key format exclusively: `sb_publishable_...` (client-side) and `sb_secret_...` (server-side). Environment variables: `NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY` and `SUPABASE_SECRET_KEY`.
**Consequences:**
- ‚úÖ Future-proof (legacy keys being deprecated), better security (independent key rotation), aligns with Supabase best practices
- ‚ö†Ô∏è Developers with legacy projects must migrate keys, documentation must clearly specify new format
- üìù See [Environment Variables Template](./env-example-template.md) for complete setup guide

## ADR-003: Server Actions for Mutations

**Status:** Accepted
**Date:** 2025-11-25
**Context:** Need to choose between Server Actions and API Route Handlers for form submissions and mutations.
**Decision:** Use Server Actions for all mutations (createOrder, loginAdmin), Route Handlers only for webhooks (Stripe).
**Consequences:**
- ‚úÖ Simpler than route handlers, type-safe, less boilerplate, built-in CSRF protection
- ‚ö†Ô∏è Cannot be called from external sources (not needed for MVP)

## ADR-004: React Context for Cart State

**Status:** Accepted
**Date:** 2025-11-25
**Context:** Need state management for shopping cart without adding external dependencies.
**Decision:** Use React Context API for cart state, no external state library (Zustand, Redux).
**Consequences:**
- ‚úÖ Simple, zero dependencies, sufficient for cart state
- ‚ö†Ô∏è May need to refactor to Zustand if state complexity grows (unlikely for MVP)

## ADR-005: Docker Deployment

**Status:** Accepted
**Date:** 2025-11-25
**Context:** Need containerized deployment for portability and consistency across environments.
**Decision:** Docker Compose for local dev, Docker containers for production deployment.
**Consequences:**
- ‚úÖ Consistent environments, easy scaling, portable across hosting providers
- ‚ö†Ô∏è Requires Docker knowledge, slightly more complex local setup

## ADR-006: No Real-time for MVP

**Status:** Accepted
**Date:** 2025-11-25
**Context:** Supabase provides real-time subscriptions, but adds complexity.
**Decision:** Defer real-time features to post-MVP. Use standard polling or manual refresh for admin dashboard.
**Consequences:**
- ‚úÖ Simpler MVP implementation, faster time to market
- ‚ö†Ô∏è Admin dashboard won't auto-update on new orders (acceptable for MVP)

## ADR-007: Recharts for Data Visualization

**Status:** Accepted
**Date:** 2025-11-25
**Context:** Admin dashboard needs revenue charts and payment breakdowns.
**Decision:** Use Recharts 3.5.0 for all data visualizations.
**Consequences:**
- ‚úÖ React-native, simple API, good compatibility with shadcn/ui, latest version (released 2025-11-24)
- ‚ö†Ô∏è Larger bundle size than pure SVG, but acceptable for admin dashboard (not customer-facing)

---

_Generated by BMAD Decision Architecture Workflow v1.0_
_Date: 2025-11-25_
_For: Facundo_
